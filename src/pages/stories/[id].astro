---
import Layout from '../../layouts/Layout.astro';
import { getAllStories, getStoryById, type Story } from '../../lib/stories';
import DesktopStoryReader from '../../components/story/desktop/DesktopStoryReader.astro';
import MobileStoryReader from '../../components/story/mobile/MobileStoryReader.astro';

export async function getStaticPaths() {
  const stories = await getAllStories();
  return stories.map((story: Story) => ({
    params: { id: story.id }
  }));
}

const { id } = Astro.params;
const story = await getStoryById(id!);

if (!story) {
  return Astro.redirect('/404');
}

const userAgent = Astro.request.headers.get('user-agent') || '';
const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);
---

<Layout title={story.config.title}>
  {isMobile ? (
    <MobileStoryReader story={story} />
  ) : (
    <DesktopStoryReader story={story} />
  )}
</Layout>
